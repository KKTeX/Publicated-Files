%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% KKindexmaking.sty — Custom Index Design Package
%%
%% Version: 1.0.0 (2025/10/07)
%% Author : KKTeX
%% License: MIT License
%% Source : https://qiita.com/munepi/items/2e1524859e24b5fb44bc
%%
%% -----------------------------------------------------------------------------
%% Overview
%% -----------------------------------------------------------------------------
%% This package redefines the LaTeX index layout with a modern, multi-column,
%% and colored style. It uses multicolrule for column separation, tcolorbox for
%% decorative titles, and provides several customization keys for easy control
%% over the index format.
%%
%% -----------------------------------------------------------------------------
%% Requirements
%% -----------------------------------------------------------------------------
%% - Compiles with pdfLaTeX, LuaLaTeX, or XeLaTeX.
%% - Required packages:
%%     kvoptions, makeidx, multicol, multicolrule, tcolorbox, fancyhdr,
%%     needspace, xcolor
%%
%% -----------------------------------------------------------------------------
%% Basic Usage
%% -----------------------------------------------------------------------------
%%
%%   \usepackage{KKindexmaking}
%%   \makeindex
%%
%%   ...
%%   \printindex
%%
%% In the document body, use \index{term} as usual.
%% The package automatically formats the index into a multi-column layout with
%% decorative titles and dotted/solid column rules.
%%
%% -----------------------------------------------------------------------------
%% Package Options
%% -----------------------------------------------------------------------------
%%
%% \usepackage[
%%   column=<n>,          % Number of columns (default: 3)
%%   linestyle=<style>,   % 1=densely dotted, 2=dotted, other=solid (default: 3)
%%   linewidth=<dimen>,   % Width of column rule (default: .8pt)
%%   idxtitle={<title>},  % Title of the main index (default: "Index of Terms")
%%   symboltitle={<title>} % Title for symbol/numerical entries (default: 記号・数字)
%% ]{KKindexmaking}
%%
%% Example:
%%   \usepackage[column=2,linestyle=1,linewidth=1pt,
%%               idxtitle={\hspace*{1em}Index\hspace*{1em}},
%%               symboltitle={Symbols and Numbers}]{KKindexmaking}
%%
%% -----------------------------------------------------------------------------
%% Custom Commands
%% -----------------------------------------------------------------------------
%%
%%   \makeidxhead{<heading>}
%%       → Creates a decorative section header for groups within the index.
%%         For example:
%%             \makeidxhead{A}
%%             \item Apple
%%             \item Atom
%%
%%   \symbolindexname
%%       → Expands to the value of the ‘symboltitle’ option.
%%
%%   \idxdelim
%%       → Defines the leader dots between entry and page number.
%%
%% -----------------------------------------------------------------------------
%% Index Formatting
%% -----------------------------------------------------------------------------
%%
%% - The index is typeset using the ‘multicols*’ environment.
%% - Column separator style is defined via \SetMCRule depending on the option
%%   `linestyle`.
%% - Page numbers are aligned using dot leaders.
%% - Entries are formatted as:
%%       \item      main entry
%%       \subitem   subentry (indented)
%%       \subsubitem deeper subentry (further indented)
%%
%% -----------------------------------------------------------------------------
%% Colors and Design
%% -----------------------------------------------------------------------------
%%
%% - The main title (Index of Terms) is displayed in a colored tcolorbox header.
%% - The default color is a teal-like tone defined as
%%       RGB(0, 128, 140)
%%   You can modify this color in the .sty file by changing:
%%       \definecolor{tealgreenforKKindexmaking}{RGB}{0, 128, 140}
%%
%% -----------------------------------------------------------------------------
%% Notes and Limitations
%% -----------------------------------------------------------------------------
%%
%% - This package assumes that \makeindex and \printindex are used properly.
%% - The title box height (currently ~7.4ex) may require adjustment for certain fonts.
%% - Works in both single- and two-sided documents.
%% - The rule style (densely dotted, dotted, solid) is handled by multicolrule.
%%
%% -----------------------------------------------------------------------------
%% Compilation
%% -----------------------------------------------------------------------------
%%
%% Typical build process:
%%   $ pdflatex main.tex
%%   $ makeindex main
%%   $ pdflatex main.tex
%%
%% -----------------------------------------------------------------------------
%% Example
%% -----------------------------------------------------------------------------
%%
%% \documentclass{book}
%% \usepackage[column=3,linestyle=2,linewidth=0.6pt,
%%             idxtitle={\hspace*{1em}Index of Terms\hspace*{1em}},
%%             symboltitle={Symbols}]{KKindexmaking}
%% \makeindex
%%
%% \begin{document}
%% Some text\index{LaTeX} and more text\index{TeX}.
%%
%% \clearpage
%% \printindex
%% \end{document}
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{KKindexmaking}[2025/10/07, Version 1.0.0]


\RequirePackage[most]{tcolorbox}
\RequirePackage{makeidx}
\RequirePackage{needspace}
\RequirePackage{kvoptions,fancyhdr,multicol,multicolrule} 
\RequirePackage[dvipsnames, svgnames, x11names]{xcolor}


\SetupKeyvalOptions{%
  family=KKidx,%
  prefix=KKidx@%
}
\DeclareStringOption[3]{column}
\DeclareStringOption[3]{linestyle}
\DeclareStringOption[0.8pt]{linewidth}
\DeclareStringOption[\hspace*{1em}Index of Terms\hspace*{1em}]{idxtitle}
\DeclareStringOption[記号・数字]{symboltitle}

\ProcessKeyvalOptions*

\def\KKidxcolumn{\KKidx@column}
\def\KKidxlinestyle{\KKidx@linestyle}
\def\KKidxlinewidth{\KKidx@linewidth}
\def\KKidxidxtitle{\KKidx@idxtitle}
\def\KKidxsymboltitle{\KKidx@symboltitle}

\ifnum\KKidxlinestyle=1
  \SetMCRule{line-style=densely-dotted, width=\KKidx@linewidth}%
\else\ifnum\KKidxlinestyle=2
  \SetMCRule{line-style=dots, width=\KKidx@linewidth}%
\else
  \SetMCRule{line-style=solid, width=\KKidx@linewidth}%
\fi\fi


\newcommand{\MyClearDoublePage@KKindexmaking}{%
\clearpage
  \if@twoside
    \ifodd\c@page\else
      \begingroup
        \null
        \thispagestyle{fancy}%
        \newpage
      \endgroup
    \fi
  \fi
}

\definecolor{tealgreenforKKindexmaking}{RGB}{0, 128, 140}
\newtcbox{\titleboxformokuji@KKindexmaking}{enhanced,coltext=white,colback=tealgreenforKKindexmaking!70!white,colframe=white,sharp corners,halign=center,valign=center,left=0pt, right=0pt, top=0pt, bottom=0pt,boxsep=0pt,height=7.4ex,box align=base,fontupper=\Large \bfseries\gtfamily}

\makeindex

\renewenvironment{theindex}{%
  \MyClearDoublePage@KKindexmaking
  \columnsep3\zw
  \begin{multicols*}{\KKidxcolumn}[\titleboxformokuji@KKindexmaking{\hspace*{1em}\KKidx@idxtitle\hspace*{1em}}]%
    \small
    \@mkboth{\indexname}{\indexname}%
    \parindent\z@
    \parskip\z@
    \lineskiplimit\z@
    \lineskip\z@
    \raggedbottom
    \raggedcolumns
    \raggedright
    \let\item\@idxitem}
  {\end{multicols*}
   \clearpage}

\renewcommand{\@idxitem}{\par\leavevmode\hangindent1\zw\inhibitglue}
\renewcommand{\subitem}{\@idxitem\hangindent2\zw\hspace*{1\zw}\inhibitglue}
\renewcommand{\subsubitem}{\@idxitem\hangindent3\zw\hspace*{2\zw}\inhibitglue}
\renewcommand{\indexspace}{\par\vskip\baselineskip\relax}

\newcommand\idxdelim{\nobreak{\reset@font\scriptsize\space
  \leaders\hbox to .3333\zw{\hss\hbox{.}\hss}\hfill\space}\nobreak}

\newcommand*{\symbolindexname}{\KKidxsymboltitle}

\newcommand{\cdotFill}{\leavevmode\leaders\hbox{$\raisebox{.2ex}{\cdot}$\kern0.01em}\hfill\kern0pt}

\NewDocumentCommand{\makeidxhead}{m}{%
  \needspace{2\baselineskip}%
  \vspace{\baselineskip}%
  \hbox to \columnwidth{\hfil
    \normalsize\gtfamily\bfseries
    \textcolor{DeepSkyBlue3}{■\cdotFill\hspace{.5\zw}#1\hspace{.5\zw}\cdotFill■\hfil}}\par
  \nopagebreak
}
\endinput